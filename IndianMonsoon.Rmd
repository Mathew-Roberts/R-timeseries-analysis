---
title: "Time Series Analysis"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Indian Monsoon Data


Below I will be plotting the Indian Monsoon Data. I first attach the data, and convert it to a time series class.
I use the *plot* function to show the monsoon data.

```{r q1}
library(readxl)
IndianMonsoon <- read_excel("IndianMonsoon.xlsx")
attach(IndianMonsoon)
library(astsa)
#Changing into time series format
IM_ts <- ts(RainFall, frequency = 1, start = 1813)
#Plotting time series
plot(IM_ts, main ="Summer Monsoon Rainfall in India", ylab = "Rainfall in ml")
```


Below I have detrended the data using the *diff* operator, and have plotted the resulting time series. I used the augmented Dickey-Fuller (ADF) test and the the KPSS test tp test whether the detrended data is weakly stationary. In order to confident that the data is weakly stationary at confidence level $\alpha = 0.05$, we must reject the null hypothesis of the ADF test and not reject the null hypothesis of the KPSS test.

```{r q2}
#differencing time series
diff_IM <- diff(IM_ts)
#plotting differenced time series
plot(diff_IM, main = "Trend Differenced Monsoon Rainfall ", ylab = "")
#detrended data looks weakly stationary, oscillations are regular without many spikes and it oscillates around 0.
#Dickey fuller test
library(tseries)
adf.test(IM_ts)
#we reject H_0 - this is good
library(fpp3)
unitroot_kpss(IM_ts)
```
In the ADF test we see that the p-value is 0.01, however as *R* states, it is likely to be even smaller than this therefore we reject the null hypothesis at $\alpha$. For the KPSS tests we see that the p-value is 0.10000; this is larger than the value of $\alpha$, therefore we do not reject the null hypothesis. Hence we conclude that the detrended data is weakly stationary at significance level $\alpha = 0.05$.


Here, I have plotted the sample ACF and PACF at 100 lags, to give an indication of the model of the data.

```{r q3}
acf2(diff_IM, max.lag = 100, main = "Differenced Monsoon Data")
#cut off at lag one in ACF, therefore this is a moving average 1 model (MA(1)) - 95% so 5% exceed the lines
```

The ACF of the differenced monsoon data cuts off after lag 1 and the PACF shows exponential decay after lag 1. This is characteristic of an **MA(1)** model. After lag 1, roughly 5% of the ACF(h) lines lie outside the blue significance lines - this is not significant at $\alpha = 0.05$.


We are now in position to estimate chosen model using maximum likelihood. Our model *model* will be constructed using the *sarima* function in *R*.

```{r q4}
model = sarima(IM_ts, 0,1,1)
```
The *sarima* model (in this case) takes the arguments of p,d and q where p is the order for AR(p), d is the order for differencing and q is the MA(q) order. We have differenced the model once, and we then suggested an **MA(1)** model for the differenced data.

We can look at the estimates for model *model* and see if they resemble a trend differenced **MA(1)** model.
```{r q5}
model$ttable
```
We can see that the *ma1* value is almost 1, therefore this suggests that our initial suggestion that the differenced data resembles an **MA(1)** model holds for significance level $\alpha = 0.05$.


Let us examine the diagnostic plots generated by *model* so that we can be confident that our model is suitable for the Indian Monsoon Data.

```{r q6}
model = sarima(IM_ts, 0,1,1)
```

The standardised residuals look like an i.i.d sequence, there are regular oscillations around 0 with not too many spikes. The mean is almost 0 at 0.0529 which is expected for a white noise sequence. The ACF of the residuals also lie within the blue significance lines, which further suggests that the residuals are an i.i.d sequence. The majority of the data points in the Normalised Q-Q plot also lie close to or on the blue line as would be expected of an i.i.d sequence. 

The last plot showing the p-values for the Ljung-Box statistic also show that for each lag, the p-value is greater than the significance level of $\alpha$. The null hypothesis of this statistic states that the residuals are independent, and since the p-value's are greater than the significance level, then we do not reject this null hypothesis.

We include one final test, the Ljung-Box Q test statistic, which is an aggregated version of the above Ljung-Box statistic. It considers all lags and considers the null hypothesis that the data is independently distributed.

```{r q6b}
Box.test(resid(model$fit), lag = 20, type = "Ljung-Box", fitdf = 1)
```
We observe a p-value of 0.4921, which is well above the significance level $\alpha = 0.05$, therefore we do not reject the null hypothesis.


The full model that I have identified is a trend-differenced **MA(1)** model. I have concluded that this is the best model due to a number of factors. The standardised residuals from the model and the monsoon data strongly resemble white noise, this is corroborated by the results of Ljung-Box test as well as the ACF and Q-Q plots of the residuals. The ACF of the trend differenced data also shows a cut off at lag 1, and the PACF shows exponential decay after lag 1 - these characteristics are most common in the **MA(1)** model. The following observations were made at significance level $\alpha = 0.05$, therefore I can say that this model is suitable at this level.




